{% extends "layout.html" %}
{% block content %}
  <h1>Merchants by Spend</h1>
  <form method="get" action="/expenses/merchants" class="box">
    <label>Year <input name="year" value="{{ year }}" size="6" /></label>
    <label>Month (optional) <input name="month" value="{{ month or '' }}" size="4" placeholder="1-12" /></label>
    <label>Account
      <select name="account_id">
        <option value="0">(all)</option>
        <option value="credit" {% if account_id=="credit" %}selected{% endif %}>(all credit cards)</option>
        <option value="bank" {% if account_id=="bank" %}selected{% endif %}>(all bank accounts)</option>
        {% for a in accounts %}
          <option value="{{ a.id }}" {% if account_id==(a.id|string) %}selected{% endif %}>{{ a.institution }} â€” {{ a.name }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Limit <input name="limit" value="{{ limit }}" size="6" /></label>
    <button type="submit">Run</button>
  </form>

  {% if rows %}
    <table>
      <thead><tr><th>Merchant</th><th>Category</th><th class="num">Spend</th><th class="num">Txn count</th></tr></thead>
      <tbody>
        {% for r in rows %}
          <tr>
            <td class="nowrap">
              <a href="/expenses/merchant?name={{ r.merchant|urlencode }}&year={{ year }}{% if month %}&month={{ month }}{% endif %}{% if account_id and account_id!='0' %}&account_id={{ account_id }}{% endif %}">{{ r.merchant }}</a>
            </td>
            <td class="nowrap">{{ r.category }}</td>
            <td class="nowrap num">{{ r.spend|usd }}</td>
            <td class="nowrap num">{{ r.txn_count }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="muted">No merchant spend found (charges only; payments/credits excluded).</div>
  {% endif %}
{% endblock %}
