<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or "Investor MVP" }}</title>
    <link rel="stylesheet" href="/static/app.css?v={{ static_version or '0' }}" />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar__left">
        <a href="/">Dashboard</a>
        <a href="/setup">Setup</a>
        <a href="/policy">Policy</a>
        <a href="/holdings">Holdings</a>
        <a href="/holdings/cash">Cash</a>
        <a href="/holdings/bullion">Bullion</a>
        <a href="/holdings/transactions">Transactions</a>
        <a href="/holdings/lots">Lots</a>
        <a href="/taxlots/gains?source=auto">Tax Lots</a>
        <a href="/holdings/income">Income</a>
        <a href="/holdings/assignments">Mappings</a>
        <a href="/holdings/securities">Securities</a>
        <a href="/imports">Imports</a>
        <a href="/expenses">Expenses</a>
        <a href="/planner">Planner</a>
        <a href="/plans">Plans</a>
        <a href="/sync/connections">Sync</a>
        <a href="/reports">Reports</a>
        <a href="/tax/summary">Tax</a>
        <a href="/audit">Audit</a>
      </div>
      <div class="topbar__right">Actor: {{ actor }}</div>
    </header>
    <div class="app-content">
      {% if auth_banner %}
        <div class="banner banner--warn">{{ auth_banner }}</div>
      {% endif %}
      <main class="container">
        {% block content %}{% endblock %}
      </main>
    </div>
    <script>
      (() => {
        const topbar = document.querySelector(".topbar");
        if (!topbar) return;
        let ticking = false;
        const setTopbarHeightVar = () => {
          try {
            const h = Math.ceil(topbar.getBoundingClientRect().height || 0);
            if (h > 0) document.documentElement.style.setProperty("--top-nav-height", `${h}px`);
          } catch {
            // ignore
          }
        };
        const apply = () => {
          ticking = false;
          topbar.classList.toggle("is-scrolled", (window.scrollY || 0) > 0);
        };
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          window.requestAnimationFrame(apply);
        };
        setTopbarHeightVar();
        apply();
        window.addEventListener("scroll", onScroll, { passive: true });
        window.addEventListener("resize", setTopbarHeightVar, { passive: true });

        // Keep offsets correct if the nav height changes due to wrapping, font load, or responsive reflow.
        try {
          if ("ResizeObserver" in window) {
            const ro = new ResizeObserver(() => setTopbarHeightVar());
            ro.observe(topbar);
          }
        } catch {
          // ignore
        }
        try {
          if (document.fonts && document.fonts.ready) {
            document.fonts.ready.then(() => setTopbarHeightVar()).catch(() => {});
          }
        } catch {
          // ignore
        }
      })();
    </script>
  </body>
</html>
